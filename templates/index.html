<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNCIA Project Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
            color: white;
        }

        /* Header Section */
        .header {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(147, 51, 234, 0.3) 100%);
            backdrop-filter: blur(20px);
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Top Navigation Bar */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .logo-section {
            flex-shrink: 0;
        }

        .uncia-logo {
            height: 3rem;
            width: auto;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .teams-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .teams-icon {
            width: 1.5rem;
            height: 1.5rem;
            background: linear-gradient(45deg, #1e40af, #7c3aed);
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-dot {
            width: 0.5rem;
            height: 0.5rem;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .join-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .join-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        /* Main Title Section */
        .title-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .main-title {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #ffffff 0%, #e2e8f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .project-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .tab-list {
            display: flex;
            background: rgba(255, 255, 255, 0.15);
            padding: 0.5rem;
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .tab-button {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            white-space: nowrap;
        }

        .tab-button.active {
            background: #B197C5;
            color: #0f172a;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .tab-button:hover:not(.active) {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        /* Main Content Area */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem 3rem;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Content Cards */
        .content-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: white;
        }

        .icon {
            width: 1.5rem;
            height: 1.5rem;
            fill: currentColor;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.3);
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-icon {
            width: 3.5rem;
            height: 3.5rem;
            margin: 0 auto 1rem;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: white;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        /* Two Column Layout */
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            margin-top: 2rem;
        }

        .health-section h3 {
            color: white;
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
        }

        .health-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .health-label {
            color: rgba(255, 255, 255, 0.8);
            text-transform: capitalize;
        }

        .health-progress {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .progress-bar {
            width: 5rem;
            height: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 0.25rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 0.25rem;
            transition: width 0.8s ease;
        }

        .progress-green { background: #22c55e; }
        .progress-yellow { background: #eab308; }
        .progress-red { background: #ef4444; }

        .health-value {
            color: white;
            font-weight: 600;
            min-width: 2.5rem;
            text-align: right;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 1rem;
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .metric-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        /* Action Items and Risks */
        .action-risk-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .item-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .list-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 0.75rem;
            border-left: 4px solid;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .item-title {
            color: White;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .item-meta {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
        }

        .priority-high { border-left-color: #ef4444; }
        .priority-medium { border-left-color: #eab308; }
        .priority-low { border-left-color: #22c55e; }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-high { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }
        .badge-medium { background: rgba(245, 158, 11, 0.2); color: #fcd34d; }
        .badge-low { background: rgba(34, 197, 94, 0.2); color: #86efac; }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .header-container, .main-content {
                padding-left: 1.5rem;
                padding-right: 1.5rem;
            }
            
            .two-column, .action-risk-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .tab-list {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        /* Loading Spinner */
        .loading-spinner {
            width: 1.5rem;
            height: 1.5rem;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .main-title {
                font-size: 2.5rem;
            }
            
            .top-nav {
                flex-direction: column;
                gap: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 640px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-button {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
        }

        /* Kanban Board Styles */
        .kanban-board-container {
            background: linear-gradient(135deg, #3a0050 0%, #6a008a 50%, #200030 100%);
            border-radius: 2rem;
            padding: 2.5rem 2rem;
            margin-top: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            overflow-x: auto; /* Allow horizontal scrolling for columns */
            white-space: nowrap; /* Prevent columns from wrapping */
        }

        .kanban-board-title {
            font-size: 2.25rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 2rem;
            text-align: center;
        }

        .kanban-columns-container {
            display: flex;
            gap: 1.5rem;
            padding-bottom: 1rem; /* Space for scrollbar */
            align-items: flex-start; /* Align columns to the top */
        }

        .kanban-column {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 1rem;
            padding: 1.5rem;
            min-width: 280px;
            max-width: 320px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            height: fit-content; /* Adjust height to content */
            max-height: 70vh; /* Max height for scrollable columns */
            overflow-y: auto; /* Enable vertical scrolling for cards */
            scrollbar-width: thin; /* Firefox scrollbar */
            scrollbar-color: #8b5cf6 rgba(255, 255, 255, 0.1); /* Firefox scrollbar colors */
        }

        /* Custom scrollbar for Webkit browsers */
        .kanban-column::-webkit-scrollbar {
            width: 8px; /* For vertical scrollbar */
            height: 8px; /* For horizontal scrollbar */
        }

        .kanban-column::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .kanban-column::-webkit-scrollbar-thumb {
            background-color: #8b5cf6; /* Purple thumb */
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .column-header h3 {
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .column-header span {
            background: rgba(255, 255, 255, 0.15);
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 500;
            color: white;
        }

        .card-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .kanban-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
            cursor: grab;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .kanban-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .kanban-card.card-done {
            border-left: 5px solid #28a745; /* Green */
        }

        .kanban-card.card-in-progress {
            border-left: 5px solid #007bff; /* Blue */
        }

        .kanban-card.card-not-started {
            border-left: 5px solid #6c757d; /* Grey */
        }

        .kanban-card.card-other {
            border-left: 5px solid #eab308; /* Yellow/Orange for unmapped */
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.5rem;
            white-space: normal;
            line-height: 1.4;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.75rem;
        }

        .card-key {
            font-weight: 600;
        }

        .card-date {
            font-style: italic;
        }

        .card-status-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 1rem;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 0.5rem;
            text-align: center;
        }

        .badge-completed {
            background: rgba(40, 167, 69, 0.3); /* Green */
            color: #28a745;
        }

        .badge-in-progress {
            background: rgba(0, 123, 255, 0.3); /* Blue */
            color: #007bff;
        }

        .badge-not-started {
            background: rgba(108, 117, 125, 0.3); /* Grey */
            color: #6c757d;
        }

        .badge-other {
            background: rgba(234, 179, 8, 0.3); /* Yellow */
            color: #eab308;
        }

        /* Responsive Adjustments for Kanban */
        @media (max-width: 1200px) {
            .kanban-column {
                min-width: 260px;
                max-width: 300px;
            }
        }

        @media (max-width: 768px) {
            .kanban-board-container {
                padding: 1.5rem;
            }
            .kanban-board-title {
                font-size: 1.8rem;
                margin-bottom: 1.5rem;
            }
            .kanban-column {
                min-width: 250px;
                max-width: 100%; /* Allow full width on smaller screens if only one column fits */
            }
            .column-header h3 {
                font-size: 1rem;
            }
            .kanban-card {
                padding: 0.8rem;
            }
            .card-title {
                font-size: 0.95rem;
            }
            .card-meta {
                font-size: 0.75rem;
            }
            .card-status-badge {
                font-size: 0.65rem;
                padding: 0.25rem 0.6rem;
            }
        }

        @media (max-width: 480px) {
            .kanban-columns-container {
                flex-direction: column;
                align-items: center;
            }
            .kanban-column {
                width: 95%; /* Almost full width for single column stack */
                max-width: 350px; /* Limit max width even when stacked */
            }
        }

        /* New Project Progress Timeline Section */
        .project-progress-timeline-container {
            margin-bottom: 2rem;
        }

        .timeline-header-new {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .timeline-title-new {
            font-size: 1.25rem;
            font-weight: 600;
            color: white;
        }

        .overall-progress-new {
            font-size: 1.25rem;
            font-weight: 600;
            color: white;
        }

        .timeline-line-container {
            position: relative;
            height: 1.5rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .horizontal-line-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
        }

        .horizontal-line-fill {
            position: absolute;
            top: 0;
            left: 0;
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #8b5cf6);
            border-radius: 0.75rem;
            transition: width 0.8s ease;
        }

        .horizontal-line-glow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
        }

        .timeline-nodes-grid {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            position: relative;
            width: 100%;
            padding: 0 25px; /* Adjust padding to make space for end nodes */
            box-sizing: border-box;
        }

        .timeline-node {
            width: 1rem;
            height: 1rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            cursor: pointer;
        }

        .timeline-node.completed {
            background: #28a745;
        }

        .timeline-node.in-progress {
            background: #007bff;
        }

        .timeline-node.not-started {
            background: #6c757d;
        }

        .timeline-node.other {
            background: #eab308;
        }

        /* New Timeline Node and Label Styles */
        .timeline-node-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            width: 150px; /* Adjust as needed */
            text-align: center;
        }

        .timeline-node-circle {
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            border: 2px solid white;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .timeline-node-circle.completed {
            background-color: #22c55e;
            border-color: #16a34a;
        }

        .timeline-node-circle.in-progress {
            background-color: #3b82f6;
            border-color: #2563eb;
        }

        .timeline-node-circle.not-started {
            background-color: #6b7280;
            border-color: #4b5563;
        }

        .timeline-node-circle.pending {
            background-color: #eab308;
            border-color: #d97706;
        }

        .timeline-node-circle .inner-dot {
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            background-color: white;
            display: block;
        }

        .timeline-node-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.85rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .timeline-node-progress {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.75rem;
        }

        .timeline-node-line {
            position: absolute;
            height: 2px;
            background-color: rgba(255, 255, 255, 0.3);
            top: 50%; /* Center with respect to the line container */
            transform: translateY(-50%);
        }

        /* New Timeline Styles */
        .timeline-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin: 4rem 0;
            position: relative;
        }

        .timeline-progress {
            position: absolute;
            height: 4px;
            background: linear-gradient(to right, #4CAF50, #8A2BE2); /* Green to Purple */
            background-size: 200% 100%; /* For the animation */
            z-index: 0;
            top: 50%;
            transform: translateY(-50%);
            left: 0;
            width: 50%; /* Example: adjust dynamically based on progress */
            border-radius: 2px;
            transition: width 0.7s ease-out; /* Smooth transition for width */
            animation: gradientPulse 3s infinite alternate; /* Pulsating gradient animation */
        }

        @keyframes gradientPulse {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .timeline-node {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1;
            opacity: 0;
            transform: translateY(10px);
            animation: nodeFadeIn 0.5s ease-out forwards;
            /* animation-delay will be set via JS */
        }

        @keyframes nodeFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .node-circle {
            width: 40px;
            height: 40px;
            background-color: #581c87; /* Dark purple from background */
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            border: 2px solid #9333ea; /* Purple border */
            transition: all 0.3s ease;
            aspect-ratio: 1/1; /* Ensure perfect circle aspect ratio */
        }

        .node-circle.completed {
            background-color: #22c55e; /* Green for completed */
            border-color: #22c55e;
            animation: nodeCompleteBounce 0.4s ease-out;
        }

        @keyframes nodeCompleteBounce {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }

        .node-circle.current {
            background-color: #8B5CF6; /* Lighter purple for current */
            border-color: #8B5CF6;
            animation: nodeCurrentPulse 1.5s infinite alternate;
        }

        @keyframes nodeCurrentPulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }

        .node-circle .check-icon {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .node-label {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .node-circle.completed + .node-label {
            color: white;
        }
        /* End New Timeline Styles */

        /* Project Details Specific Styles */
        .project-description-text {
            font-size: 1.1rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.85);
            text-align: justify;
        }

        .deliverables-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .deliverables-list li {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid;
            transition: all 0.2s ease;
        }

        .deliverables-list li:last-child {
            margin-bottom: 0;
        }

        .deliverables-list li.completed {
            border-left-color: #22c55e; /* Green */
        }

        .deliverables-list li.in-progress {
            border-left-color: #eab308; /* Yellow */
        }

        .deliverables-list li.pending {
            border-left-color: #ef4444; /* Red */
        }

        .deliverable-item {
            font-size: 1rem;
            font-weight: 500;
            color: white;
        }

        .deliverable-status {
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.3rem 0.8rem;
            border-radius: 1rem;
            text-transform: uppercase;
        }

        .deliverable-status.completed {
            background: rgba(34, 197, 94, 0.2); /* Green background */
            color: #86efac; /* Lighter green text */
        }

        .deliverable-status.in-progress {
            background: rgba(234, 179, 8, 0.2); /* Yellow background */
            color: #fcd34d; /* Lighter yellow text */
        }

        .deliverable-status.pending {
            background: rgba(239, 68, 68, 0.2); /* Red background */
            color: #fca5a5; /* Lighter red text */
        }

        .deliverable-date {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            margin-left: 1rem;
        }

        /* Team Members Specific Styles */
        .team-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .team-member-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 1rem;
            text-align: center;
            transition: transform 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .team-member-card:hover {
            transform: translateY(-5px);
        }

        .member-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 1rem;
            border: 3px solid #8b5cf6;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .member-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.25rem;
        }

        .member-role {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.5rem;
        }

        .member-email {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .header-container, .main-content {
                padding-left: 1.5rem;
                padding-right: 1.5rem;
            }
            
            .two-column, .action-risk-grid, .team-list {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .tab-list {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        .team-members-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            padding: 1rem;
        }

        .team-member-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .team-member-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .member-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-bottom: 1rem;
            border: 3px solid rgba(255, 255, 255, 0.2);
        }

        .member-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: white;
        }

        .member-role {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.5rem;
        }

        .member-email {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div id="loading-indicator" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; display: flex; justify-content: center; align-items: center; color: white; font-size: 2rem;">Loading...</div>
    <div id="error-message" style="display: none; position: fixed; top: 0; left: 0; width: 100%; background: #ef4444; color: white; padding: 1rem; text-align: center; z-index: 1001;"></div>
    <!-- Header Section -->
    <header class="header">
        <div class="header-container">
            <!-- Top Navigation -->
            <div class="top-nav">
                <div class="logo-section">
                    <img src="{{ url_for('static', filename='images/Uncia2 1.jpg') }}" alt="UNCIA Logo" class="uncia-logo" />
            </div>

                <div class="nav-controls">
                    <div class="teams-badge">
                        <div class="teams-icon">
                            <svg viewBox="0 0 24 24" style="width: 1rem; height: 1rem; fill: white;">
                                <path d="M20.625 5.25H15.75v13.5h4.875c.621 0 1.125-.504 1.125-1.125V6.375c0-.621-.504-1.125-1.125-1.125z"/>
                                <path d="M14.25 5.25H9.375c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125H14.25V5.25z"/>
                                <circle cx="12" cy="12" r="2.25"/>
                            </svg>
                        </div>
                        <span id="teams-status-text" style="color: white; font-size: 0.9rem; font-weight: 500;">Teams Disconnected</span>
                        <div class="status-dot" id="teams-status-dot" style="background: #ef4444;"></div>
        </div>

                    <button class="join-btn" id="join-meeting-btn">
                        <svg style="width: 1rem; height: 1rem; fill: currentColor;" viewBox="0 0 24 24">
                            <path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        Join Meeting
                    </button>
                </div>
            </div>

            <!-- Main Title -->
            <div class="title-section">
                <h1 class="main-title">UNCIA Project Dashboard</h1>
                <div class="project-badge">
                    <div class="status-dot"></div>
                    <span id="project-display-name" style="color: white; font-weight: 500;">Client & Project Management Platform</span>
                </div>
            </div>

            <!-- Project Selector -->
            <div style="text-align: center; margin-bottom: 2rem;">
                <label for="project-select" style="color: White; margin-right: 0.5rem;">Select Project:</label>
                <select id="project-select" style="padding: 0.5rem 1rem; border-radius: 0.5rem; border: 1px solid rgba(255, 255, 255, 0.3); background: #a78bfa; color: White; font-size: 1rem;"></select>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <div class="tab-list">
                    <button class="tab-button active" data-tab="dashboard">Dashboard</button>
                    <button class="tab-button" data-tab="project-details">Project Details</button>
                    <button class="tab-button" data-tab="team-members">Team Members</button>
                    <button class="tab-button" data-tab="settings">Settings</button>
                </div>
            </div>

            <!-- New Timeline HTML -->
            <div class="timeline-container">
                <div class="timeline-progress"></div>
                <div class="timeline-node">
                    <div class="node-circle completed">
                        <svg class="check-icon" viewBox="0 0 24 24"><path d="M9.64 18.06l-4.52-4.52L6.5 12.6l3.14 3.14L17.5 9.1l1.38 1.38z"></path></svg>
                    </div>
                    <span class="node-label">Register</span>
                </div>
                <div class="timeline-node">
                    <div class="node-circle completed">
                        <svg class="check-icon" viewBox="0 0 24 24"><path d="M9.64 18.06l-4.52-4.52L6.5 12.6l3.14 3.14L17.5 9.1l1.38 1.38z"></path></svg>
                    </div>
                    <span class="node-label">Respond</span>
                </div>
                <div class="timeline-node">
                    <div class="node-circle completed">
                        <svg class="check-icon" viewBox="0 0 24 24"><path d="M9.64 18.06l-4.52-4.52L6.5 12.6l3.14 3.14L17.5 9.1l1.38 1.38z"></path></svg>
                    </div>
                    <span class="node-label">Configure</span>
                </div>
                <div class="timeline-node">
                    <div class="node-circle current">4</div>
                    <span class="node-label">Validate</span>
                </div>
                <div class="timeline-node">
                    <div class="node-circle">5</div>
                    <span class="node-label">Test</span>
                </div>
                <div class="timeline-node">
                    <div class="node-circle">6</div>
                    <span class="node-label">Go-Live</span>
                </div>
            </div>
            <!-- End New Timeline HTML -->
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="content-section">
                <div class="section-header">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    <h2 class="section-title">Executive Summary</h2>
                </div>

                <!-- New Project Progress Timeline Section -->
                <div class="project-progress-timeline-container">
                    <div class="timeline-header-new">
                        <span class="timeline-title-new">Project Progress Timeline</span>
                        <span class="overall-progress-new" id="overall-progress-timeline">0%</span>
                    </div>

                    <div class="timeline-line-container">
                        <!-- Horizontal Line -->
                        <div class="horizontal-line-bg"></div>
                        <!-- Progress Line (animated) -->
                        <div class="horizontal-line-fill" id="timeline-progress-fill-new">
                            <div class="horizontal-line-glow"></div>
                        </div>

                        <!-- Timeline Nodes -->
                        <div class="timeline-nodes-grid" id="timeline-nodes-grid">
                            <!-- Nodes will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                            <svg class="icon" style="color: white;" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4zm2 2H5V5h14v14z"/>
                            </svg>
                    </div>
                        <div class="stat-number">85</div>
                        <div class="stat-label">Total Issues</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #3b82f6, #06b6d4);">
                            <svg class="icon" style="color: white;" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                    </div>
                        <div class="stat-number">23</div>
                        <div class="stat-label">To Do</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #14b8a6);">
                            <svg class="icon" style="color: white;" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                    </div>
                        <div class="stat-number">18</div>
                        <div class="stat-label">In Progress</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f97316, #ef4444);">
                            <svg class="icon" style="color: white;" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div class="stat-number">44</div>
                        <div class="stat-label">Completed</div>
                    </div>
                </div>

                <!-- Health Metrics Section -->
                <div class="two-column">
                    <div class="health-section">
                        <h3>Project Health Score</h3>
                        <div class="health-item">
                            <span class="health-label">Overall Health</span>
                            <div class="health-progress">
                <div class="progress-bar">
                                    <div class="progress-fill progress-green" style="width: 85%;"></div>
                </div>
                                <span class="health-value">85%</span>
                            </div>
                        </div>
                        <div class="health-item">
                            <span class="health-label">Schedule</span>
                            <div class="health-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill progress-yellow" style="width: 78%;"></div>
                                </div>
                                <span class="health-value">78%</span>
                            </div>
                        </div>
                        <div class="health-item">
                            <span class="health-label">Budget</span>
                            <div class="progress-bar">
                                <div class="progress-fill progress-green" style="width: 92%;"></div>
                            </div>
                            <span class="health-value">92%</span>
                        </div>
                        <div class="health-item">
                            <span class="health-label">Quality</span>
                            <div class="health-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill progress-green" style="width: 85%;"></div>
                                </div>
                                <span class="health-value">85%</span>
                            </div>
                        </div>
                    </div>

                    <div class="health-section">
                        <h3>Key Metrics</h3>
                        <div class="metrics-grid">
                            <div class="metric-card">
                                <div class="metric-value" style="color: #22c55e;">85%</div>
                                <div class="metric-label">On Schedule</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" style="color: #3b82f6;">92%</div>
                                <div class="metric-label">Budget Health</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" style="color: #8b5cf6;">3</div>
                                <div class="metric-label">Active Risks</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" style="color: #f97316;">2</div>
                                <div class="metric-label">Pending Approvals</div>
                            </div>
                        </div>
                </div>
            </div>

                <!-- Action Items and Risks -->
                <div class="action-risk-grid">
                    <div class="content-section">
                        <div class="section-header">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M15 17h5l-5 5v-5zM4 1h5v5H4V1zm0 7h5v5H4V8zm0 7h5v5H4v-5z"/>
                            </svg>
                            <h3 class="section-title">Action Items</h3>
                        </div>
                        <div class="item-list" id="action-items-list">
                            <div class="list-item priority-high">
                                <div class="item-header">
                                    <div class="item-title">Review and approve UI mockups</div>
                                    <span class="badge badge-high">High</span>
                                </div>
                                <div class="item-meta">John Smith • Due: Jan 12, 2025</div>
                            </div>
                            <div class="list-item priority-medium">
                                <div class="item-header">
                                    <div class="item-title">Provide feedback on technical specifications</div>
                                    <span class="badge badge-medium">Medium</span>
                                </div>
                                <div class="item-meta">Sarah Johnson • Due: Jan 10, 2025</div>
                            </div>
                            <div class="list-item priority-low">
                                <div class="item-header">
                                    <div class="item-title">Schedule next milestone review meeting</div>
                                    <span class="badge badge-low">Low</span>
                                </div>
                                <div class="item-meta">Mike Davis • Due: Jan 8, 2025</div>
                            </div>
                </div>
            </div>

                    <div class="content-section">
                        <div class="section-header">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                            </svg>
                            <h3 class="section-title">Active Risks</h3>
                </div>
                        <div class="item-list" id="risks-list">
                            <div class="list-item priority-high">
                                <div class="item-header">
                                    <div class="item-title">Third-party API Integration Delays</div>
                                    <span class="badge badge-high">High</span>
            </div>
                                <div class="item-meta">Identified backup API providers and parallel development approach</div>
                            </div>
                            <div class="list-item priority-medium">
                                <div class="item-header">
                                    <div class="item-title">Resource Availability During Holidays</div>
                                    <span class="badge badge-medium">Medium</span>
                                </div>
                                <div class="item-meta">Adjusted timeline and secured additional contractor resources</div>
                            </div>
                        </div>
                    </div>
        </div>
    </div>

            <!-- Kanban Board Section integrated into Overview -->
            <div class="kanban-board-container">
                <h2 class="kanban-board-title">Project Board</h2>
                <div class="kanban-columns-container" id="kanban-columns-container">
                    <!-- Kanban columns will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Other tabs content would go here -->
        <div id="progress" class="tab-content">
            <div class="content-section">
                <div class="section-header">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    <h2 class="section-title">Project Progress</h2>
                </div>
                <div class="progress-summary" style="margin-bottom: 2rem;">
                    <p style="color: rgba(255,255,255,0.8); font-size: 1.1rem;">Overall progress snapshot:</p>
                    <div class="progress-bar" style="width: 100%; height: 1.5rem; background: rgba(255,255,255,0.2); border-radius: 0.75rem; overflow: hidden; margin-top: 1rem;">
                        <div id="overall-progress-fill" class="progress-fill progress-green" style="width: 0%; height: 100%; border-radius: 0.75rem; transition: width 0.8s ease;"></div>
                    </div>
                    <p id="overall-progress-value" style="color: white; font-weight: 600; text-align: center; margin-top: 0.5rem;">0% Completed</p>
                </div>

                <div class="section-header">
                    <h3 class="section-title">Recent Activities</h3>
                </div>
                <div class="item-list" id="recent-activities-list">
                    <p style="color: rgba(255,255,255,0.7); text-align: center; padding: 1rem;">Loading recent activities...</p>
                </div>
            </div>
        </div>

        <div id="budget" class="tab-content">
            <div class="content-section">
                <div class="section-header">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>
                    </svg>
                    <h2 class="section-title">Budget Overview</h2>
                </div>
                <div class="metrics-grid" id="budget-metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" style="color: #22c55e;" id="total-budget">$0</div>
                        <div class="metric-label">Total Budget</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" style="color: #f97316;" id="spent-budget">$0</div>
                        <div class="metric-label">Budget Spent</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" style="color: #3b82f6;" id="remaining-budget">$0</div>
                        <div class="metric-label">Remaining Budget</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" style="color: #eab308;" id="budget-burn-rate">0%</div>
                        <div class="metric-label">Burn Rate</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="deliverables" class="tab-content">
            <div class="content-section">
                <div class="section-header">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>
                    </svg>
                    <h2 class="section-title">Deliverables</h2>
                </div>
                <div class="item-list" id="deliverables-list">
                    <p style="color: rgba(255,255,255,0.7); text-align: center; padding: 2rem;">Loading deliverables...</p>
                </div>
            </div>
        </div>

        <div id="team-members" class="tab-content">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Team Members</h2>
                </div>
                <div class="team-members-grid" id="team-members-list">
                    <!-- Team members will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <!-- Project Details Tab Content -->
        <div id="project-details" class="tab-content">
            <!-- Project Description/Overview Section -->
            <div class="content-section">
                <div class="section-header">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"></path></svg>
                    <h2 class="section-title">Project Overview</h2>
                </div>
                <p id="project-description" class="project-description-text">Loading project description...</p>
            </div>

            <!-- Key Metrics/Statistics Section -->
            <div class="content-section">
                <div class="section-header">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M16 11V3H8v8H2v10h20V11h-6zM10 5h4v6h-4V5zm-2 14v-6h12v6H8z"></path></svg>
                    <h2 class="section-title">Key Metrics</h2>
                </div>
                <div id="metrics-grid" class="stats-grid">
                    <!-- Metrics will be loaded here dynamically -->
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(45deg, #10b981, #059669);">
                            <svg class="icon" viewBox="0 0 24 24"><path d="M5 13H3l9 9 9-9h-2v-2H5v2zM12 2l-9 9h2v2h14v-2h2L12 2z"></path></svg>
                        </div>
                        <div id="metric-total-tasks" class="stat-number">0</div>
                        <div class="stat-label">Total Tasks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(45deg, #f59e0b, #d97706);">
                            <svg class="icon" viewBox="0 0 24 24"><path d="M12 4.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM12 6c-3.87 0-7 3.13-7 7s3.13 7 7 7 7-3.13 7-7-3.13-7-7-7zm0 12c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-10c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
                        </div>
                        <div id="metric-completed-tasks" class="stat-number">0</div>
                        <div class="stat-label">Completed Tasks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(45deg, #ef4444, #dc2626);">
                            <svg class="icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"></path></svg>
                        </div>
                        <div id="metric-open-issues" class="stat-number">0</div>
                        <div class="stat-label">Open Issues</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(45deg, #8b5cf6, #7c3aed);">
                            <svg class="icon" viewBox="0 0 24 24"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM19 19H5V5h14v14zM7 11h10v2H7z"></path></svg>
                        </div>
                        <div id="metric-progress" class="stat-number">0%</div>
                        <div class="stat-label">Overall Progress</div>
                    </div>
                </div>
            </div>

            <!-- Deliverables/Milestones Section -->
            <div class="content-section">
                <div class="section-header">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M20 6h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-6-2h-4v2h4V4zm6 15H4V8h16v11z"></path></svg>
                    <h2 class="section-title">Deliverables & Milestones</h2>
                </div>
                <ul id="deliverables-list" class="deliverables-list">
                    <!-- Deliverables will be loaded here dynamically -->
                    <li>Loading deliverables...</li>
                </ul>
            </div>
        </div>

        <!-- Team Members Tab Content -->
        <div id="team-members" class="tab-content">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Team Members</h2>
                </div>
                <div class="team-members-grid" id="team-members-list">
                    <!-- Team members will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </main>

    <script>
        let currentProject;
        let availableProjects = [];
        let isLoading = false;
        let sessionProjectKey; // Declare sessionProjectKey globally

        const loadingIndicator = document.getElementById('loading-indicator');
        const errorMessage = document.getElementById('error-message');
        const projectSelect = document.getElementById('project-select');
        const projectDisplayName = document.getElementById('project-display-name');

        function showLoading() {
            isLoading = true;
            if (loadingIndicator) loadingIndicator.style.display = 'flex';
            if (errorMessage) errorMessage.style.display = 'none';
        }

        function hideLoading() {
            isLoading = false;
            if (loadingIndicator) loadingIndicator.style.display = 'none';
        }

        function showError(message, isError = true) {
            const errorElement = document.getElementById('error-message');
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
                errorElement.style.background = isError ? '#ef4444' : '#22c55e';
                
                // Auto-hide success messages after 3 seconds
                if (!isError) {
                    setTimeout(() => {
                        errorElement.style.display = 'none';
                    }, 3000);
                }
            }
            hideLoading();
        }

        async function fetchData(url) {
            try {
                console.log(`📡 Fetching: ${url}`);
                const response = await fetch(url);
                
                console.log(`📊 Response status: ${response.status} for ${url}`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(`❌ Error response for ${url}:`, errorText);
                    
                    try {
                        const errorJson = JSON.parse(errorText);
                        throw new Error(errorJson.error || `HTTP ${response.status}`);
                    } catch (parseError) {
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                }
                
                const data = await response.json();
                console.log(`✅ Data received for ${url}:`, data);
                return data;
            } catch (error) {
                console.error(`❌ Fetch error for ${url}:`, error);
                showError(`Failed to load data from ${url.split('?')[0]}: ${error.message}`);
                return null;
            }
        }

        async function fetchAvailableProjects() {
            console.log("🔍 Starting to fetch projects...");
            
            try {
                // First test if the server is running
                const testResponse = await fetch('/api/auth-status');
                console.log("✅ Server connection test:", testResponse.status);
                
                if (!testResponse.ok) {
                    throw new Error(`Server not responding: ${testResponse.status}`);
                }
                
                // Now try to fetch projects
                console.log("📡 Fetching projects from /api/jira/find-projects");
                const response = await fetch('/api/jira/find-projects');
                
                console.log("📊 Response status:", response.status);
                console.log("📊 Response headers:", Object.fromEntries(response.headers.entries()));
                
                if (!response.ok) {
                    // Get the error details
                    const errorText = await response.text();
                    console.error("❌ Error response body:", errorText);
                    
                    // Try to parse as JSON for better error info
                    try {
                        const errorJson = JSON.parse(errorText);
                        console.error("❌ Parsed error:", errorJson);
                        throw new Error(`API Error ${response.status}: ${errorJson.error || errorJson.message || 'Unknown error'}`);
                    } catch (parseError) {
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                }
                
                const data = await response.json();
                console.log("✅ Projects data received:", data);
                
                if (data && data.projects) {
                    console.log("✅ Found projects:", data.projects.length);
                    availableProjects = data.projects; // Assign to global availableProjects
                    const projectSelect = document.getElementById('project-select');
                    projectSelect.innerHTML = ''; // Clear existing options

                    availableProjects.forEach(project => {
                        const option = document.createElement('option');
                        option.value = project.key;
                        option.textContent = `${project.name} (${project.key})`;
                        projectSelect.appendChild(option);
                    });

                    // Set the current project based on sessionProjectKey or the first available project
                    if (sessionProjectKey && availableProjects.some(p => p.key === sessionProjectKey)) {
                        currentProject = sessionProjectKey;
                    } else if (availableProjects.length > 0) {
                        currentProject = availableProjects[0].key;
                    }
                    if (currentProject) {
                        projectSelect.value = currentProject;
                    }

                    return data.projects;
                } else {
                    console.error("❌ No projects data or invalid format:", data);
                    showError("No projects found. Please check your Jira integration.");
                    return [];
                }
                
            } catch (error) {
                console.error("❌ fetchAvailableProjects error:", error);
                showError(`Failed to load projects: ${error.message}`);
                return [];
            }
        }

        async function testJiraConnection() {
            console.log("🧪 Testing Jira connection...");
            
            try {
                const response = await fetch('/api/jira/test');
                const data = await response.json();
                
                console.log("🧪 Jira test result:", data);
                
                if (response.ok) {
                    showError(`✅ Jira Connected: ${data.user?.displayName || 'Success'}`, false);
                    } else {
                    showError(`❌ Jira Test Failed: ${data.error}`);
                }
                
                return data;
            } catch (error) {
                console.error("🧪 Jira test error:", error);
                showError(`❌ Jira Test Error: ${error.message}`);
                return null;
            }
        }

        async function fetchProjectStats() { 
            return fetchData(`/api/jira/project-stats?projectKey=${currentProject}`); 
        }

        async function fetchProjectHealth() { 
            return fetchData(`/api/jira/project-health?projectKey=${currentProject}`); 
        }

        async function fetchActionItems() { 
            return fetchData(`/api/jira/action-items?projectKey=${currentProject}`); 
        }

        async function fetchRisks() { 
            return fetchData(`/api/jira/risks?projectKey=${currentProject}`); 
        }

        async function fetchProjectProgress() { 
            return fetchData(`/api/jira/project-progress?projectKey=${currentProject}`); 
        }

        async function fetchProjectTeam() { 
            return fetchData(`/api/jira/project-team?projectKey=${currentProject}`); 
        }

        async function fetchProjectBudget() { 
            return fetchData(`/api/jira/project-budget?projectKey=${currentProject}`); 
        }

        async function fetchProjectDeliverables() { 
            return fetchData(`/api/jira/project-deliverables?projectKey=${currentProject}`); 
        }

        async function fetchTeamsAuthStatus() { 
            return fetchData('/api/teams/auth-status'); 
        }

        // New functions for Project Details tab
        async function fetchProjectOverview() {
            return fetchData(`/api/jira/project-overview?projectKey=${currentProject}`);
        }

        async function fetchKeyMetrics() {
            return fetchData(`/api/jira/key-metrics?projectKey=${currentProject}`);
        }

        async function fetchDeliverables() {
            return fetchData(`/api/jira/deliverables?projectKey=${currentProject}`);
        }

        // New functions for Team Members tab
        async function fetchTeamMembers() {
            console.log('Fetching team members for project:', currentProject);
            const data = await fetchData(`/api/jira/team-members?projectKey=${currentProject}`);
            console.log('Team members data received:', data);
            return data;
        }

        function updateTeamMembers(teamMembersData) {
            console.log('Updating team members UI with data:', teamMembersData);
            const teamMembersList = document.getElementById('team-members-list');
            if (!teamMembersList) {
                console.error('Team members list container not found!');
                return;
            }
            if (!teamMembersData || !teamMembersData.length) {
                console.log('No team members data available');
                teamMembersList.innerHTML = '<p style="color: rgba(255,255,255,0.7); text-align: center; padding: 2rem;">No team members found.</p>';
                return;
            }

            teamMembersList.innerHTML = ''; // Clear existing items
            teamMembersData.forEach(member => {
                console.log('Creating card for member:', member);
                const memberCard = document.createElement('div');
                memberCard.classList.add('team-member-card');
                memberCard.innerHTML = `
                    <img src="${member.avatarUrl || '/static/images/Uncia2 1.jpg'}" alt="${member.displayName}'s avatar" class="member-avatar">
                    <h4 class="member-name">${member.displayName}</h4>
                    <p class="member-role">${member.role || 'Team Member'}</p>
                    <p class="member-email">${member.emailAddress || 'No email available'}</p>
                `;
                teamMembersList.appendChild(memberCard);
            });
            console.log('Team members UI update completed');
        }

        function updateProjectOverview(overviewData) {
            const projectDescriptionElement = document.getElementById('project-description');
            if (projectDescriptionElement && overviewData) {
                projectDescriptionElement.textContent = overviewData.description || "No project description available.";
            }
        }

        function updateStats(stats) {
            if (!stats) return;
            
            // Update the stat cards in the overview
            const statCards = document.querySelectorAll('.stat-card');
            if (statCards.length >= 4) {
                // Total Issues
                const totalIssuesNumber = statCards[0].querySelector('.stat-number');
                if (totalIssuesNumber) totalIssuesNumber.textContent = stats.totalIssues || 0;
                
                // To Do
                const toDoNumber = statCards[1].querySelector('.stat-number');
                if (toDoNumber) toDoNumber.textContent = stats.toDo || 0;
                
                // In Progress  
                const inProgressNumber = statCards[2].querySelector('.stat-number');
                if (inProgressNumber) inProgressNumber.textContent = stats.inProgress || 0;
                
                // Completed
                const completedNumber = statCards[3].querySelector('.stat-number');
                if (completedNumber) completedNumber.textContent = stats.completed || 0;
            }
            
            console.log('✅ Stats updated:', stats);
        }

        function updateHealthMetrics(health) {
            if (!health) return;
            
            // Update health progress bars
            const healthItems = document.querySelectorAll('.health-item');
            
            healthItems.forEach((item, index) => {
                const progressFill = item.querySelector('.progress-fill');
                const healthValue = item.querySelector('.health-value');
                
                if (progressFill && healthValue) {
                    let value = 0;
                    let className = 'progress-green';
                    
                    switch(index) {
                        case 0: // Overall Health
                            value = health.overall || 0;
                            break;
                        case 1: // Schedule
                            value = health.schedule || 0;
                            className = value >= 80 ? 'progress-green' : value >= 60 ? 'progress-yellow' : 'progress-red';
                            break;
                        case 2: // Budget
                            value = health.budget || 0;
                            break;
                        case 3: // Quality
                            value = health.quality || 0;
                            break;
                    }
                    
                    progressFill.style.width = `${value}%`;
                    progressFill.className = `progress-fill ${className}`;
                    healthValue.textContent = `${value}%`;
                }
            });
            
            // Update key metrics cards
            const metricCards = document.querySelectorAll('.metric-card');
            if (metricCards.length >= 4) {
                metricCards[0].querySelector('.metric-value').textContent = `${health.onSchedule || 0}%`;
                metricCards[1].querySelector('.metric-value').textContent = `${health.budgetHealth || 0}%`;
                metricCards[2].querySelector('.metric-value').textContent = health.activeRisks || 0;
                metricCards[3].querySelector('.metric-value').textContent = health.pendingApprovals || 0;
            }
            
            console.log('✅ Health metrics updated:', health);
        }

        function updateActionItems(items) {
            if (!items || !items.length) return;

            const container = document.getElementById('action-items-list');
            if (container) {
                container.innerHTML = items.map(item => `
                    <div class="list-item priority-${item.priority.toLowerCase()}">
                        <div class="item-header">
                            <div class="item-title">${item.title}</div>
                            <span class="badge badge-${item.priority.toLowerCase()}">${item.priority}</span>
                        </div>
                        <div class="item-meta">${item.assignee} • Due: ${new Date(item.dueDate).toLocaleDateString()}</div>
                    </div>
                `).join('');
                } else {
                console.error("Action items container not found (using ID).");
            }
        }

        function updateRisks(risks) {
            if (!risks || !risks.length) return;

            const container = document.getElementById('risks-list');
            if (container) {
                container.innerHTML = risks.map(risk => `
                    <div class="list-item priority-${risk.priority.toLowerCase()}">
                        <div class="item-header">
                            <div class="item-title">${risk.title}</div>
                            <span class="badge badge-${risk.priority.toLowerCase()}">${risk.priority}</span>
                        </div>
                        <div class="item-meta">${risk.mitigation}</div>
                    </div>
                `).join('');
            } else {
                console.error("Risks container not found (using ID).");
            }
        }

        function updateProgress(progress) {
            if (!progress) return;

            const overallProgressFill = document.getElementById('overall-progress-fill');
            const overallProgressValue = document.getElementById('overall-progress-value');
            const recentActivitiesList = document.getElementById('recent-activities-list');

            if (overallProgressFill) {
                overallProgressFill.style.width = `${progress.overall_completion}%`;
            }
            if (overallProgressValue) {
                overallProgressValue.textContent = `${progress.overall_completion}% Completed`;
            }

            if (recentActivitiesList) {
                recentActivitiesList.innerHTML = progress.recent_activities.map(activity => `
                    <div class="list-item">
                        <div class="item-header">
                            <div class="item-title">${activity.title}</div>
                            <span class="badge">${activity.status}</span>
                                </div>
                        <div class="item-meta">${activity.creator} • ${new Date(activity.updated).toLocaleDateString()}</div>
                            </div>
                        `).join('');
                    } else {
                console.error("Recent activities container not found.");
            }
        }

        function updateTeam(team) {
            if (!team || !team.length) return;

            const teamMembersList = document.getElementById('team-members-list');
            if (teamMembersList) {
                teamMembersList.innerHTML = team.map(member => `
                    <div class="list-item">
                        <div class="item-header">
                            <img src="${member.avatarUrl}" alt="${member.displayName}'s avatar" style="width: 2.5rem; height: 2.5rem; border-radius: 50%; margin-right: 1rem;">
                            <div class="item-title">${member.displayName}</div>
                        </div>
                        <div class="item-meta">${member.emailAddress}</div>
                    </div>
                `).join('');
                } else {
                console.error("Team members list container not found.");
            }
        }

        function updateBudget(budget) {
            if (!budget) return;

            const totalBudget = document.getElementById('total-budget');
            const spentBudget = document.getElementById('spent-budget');
            const remainingBudget = document.getElementById('remaining-budget');
            const budgetBurnRate = document.getElementById('budget-burn-rate');

            if (totalBudget) totalBudget.textContent = `$${budget.totalBudget.toLocaleString()}`;
            if (spentBudget) spentBudget.textContent = `$${budget.spentBudget.toLocaleString()}`;
            if (remainingBudget) remainingBudget.textContent = `$${budget.remainingBudget.toLocaleString()}`;
            if (budgetBurnRate) budgetBurnRate.textContent = `${budget.burnRate}%`;
        }

        function updateDeliverables(deliverables) {
            if (!deliverables || !deliverables.length) return;

            const deliverablesList = document.getElementById('deliverables-list');
            if (deliverablesList) {
                deliverablesList.innerHTML = deliverables.map(item => `
                    <div class="list-item">
                        <div class="item-header">
                            <div class="item-title">${item.title}</div>
                            <span class="badge">${item.status}</span>
                        </div>
                        <div class="item-meta">${item.creator} • ${new Date(item.resolutionDate).toLocaleDateString()}</div>
                    </div>
                `).join('');
            } else {
                console.error("Deliverables list container not found.");
            }
        }

        function updateTeamsAuthStatus(status) {
            const statusText = document.getElementById('teams-status-text');
            const statusDot = document.getElementById('teams-status-dot');
            const joinBtn = document.getElementById('join-meeting-btn');

            if (status.authenticated) {
                if (statusText) statusText.textContent = 'Teams Connected';
                if (statusDot) statusDot.style.background = '#22c55e';
                if (joinBtn) {
                    joinBtn.onclick = () => console.log("Teams is connected. Ready to create/join meeting!");
                    joinBtn.textContent = "Create Meeting";
                }
            } else {
                if (statusText) statusText.textContent = 'Teams Disconnected';
                if (statusDot) statusDot.style.background = '#ef4444';
                if (joinBtn) {
                    joinBtn.onclick = () => {
                        window.location.href = '/oauth/teams/login';
                    };
                    joinBtn.textContent = "Connect Teams";
                }
            }
        }

        // New function to fetch New Timeline data
        async function fetchNewTimelineData() {
            return fetchData(`/api/jira/new-timeline-data?projectKey=${currentProject}`);
        }

        // New function to update the new timeline
        function updateNewTimeline(timelineData) {
            if (!timelineData || !timelineData.nodes) return;

            const timelineContainer = document.querySelector('.timeline-container');
            const timelineProgress = document.querySelector('.timeline-progress');
            if (!timelineContainer || !timelineProgress) {
                console.error("Timeline container or progress bar not found!");
                return;
            }

            // Clear existing nodes, but keep the progress bar
            timelineContainer.querySelectorAll('.timeline-node').forEach(node => node.remove());

            const totalNodes = timelineData.nodes.length;
            const completedNodes = timelineData.nodes.filter(node => node.status === 'completed').length;
            const currentNodeIndex = timelineData.nodes.findIndex(node => node.status === 'current');

            // Calculate progress for the progress bar
            // If there's a current node, progress goes up to that node's position
            // Otherwise, it's based on completed nodes
            let progressPercentage = 0;
            if (totalNodes > 1) {
                if (currentNodeIndex !== -1) {
                    progressPercentage = (currentNodeIndex / (totalNodes - 1)) * 100;
                } else if (completedNodes === totalNodes) {
                    progressPercentage = 100; // All completed
                } else if (completedNodes > 0) {
                    // If some are completed but no current, progress to last completed node
                    progressPercentage = ((completedNodes - 1) / (totalNodes - 1)) * 100;
                }
            }
            timelineProgress.style.width = `${progressPercentage}%`;

            timelineData.nodes.forEach((node, index) => {
                const nodeElement = document.createElement('div');
                nodeElement.classList.add('timeline-node');
                nodeElement.style.animationDelay = `${index * 0.1}s`; // Staggered animation delay

                const nodeCircle = document.createElement('div');
                nodeCircle.classList.add('node-circle');

                if (node.status === 'completed') {
                    nodeCircle.classList.add('completed');
                    nodeCircle.innerHTML = '<svg class="check-icon" viewBox="0 0 24 24"><path d="M9.64 18.06l-4.52-4.52L6.5 12.6l3.14 3.14L17.5 9.1l1.38 1.38z"></path></svg>';
                } else if (node.status === 'current') {
                    nodeCircle.classList.add('current');
                    nodeCircle.textContent = node.label;
                } else {
                    nodeCircle.textContent = node.label;
                }

                const nodeLabel = document.createElement('span');
                nodeLabel.classList.add('node-label');
                nodeLabel.textContent = node.name;

                nodeElement.appendChild(nodeCircle);
                nodeElement.appendChild(nodeLabel);
                timelineContainer.appendChild(nodeElement);
            });
            console.log('✅ New Timeline updated successfully', timelineData);
        }

        // Existing function to fetch Kanban data
        async function fetchKanbanData() {
            return fetchData(`/api/jira/kanban-board-data?projectKey=${currentProject}`);
        }

        // Existing function to update Kanban board
        function updateKanbanBoard(kanbanData) {
            if (!kanbanData) return;

            const kanbanContainer = document.getElementById('kanban-columns-container');
            if (!kanbanContainer) {
                console.error("Kanban columns container not found!");
                return;
            }

            kanbanContainer.innerHTML = ''; // Clear existing columns

            const columnOrder = [
                "TO DO",
                "DAY 0 INITIATION",
                "READINESS FOR DAY 1",
                "SOLUTION DESIGN",
                "IN PROGRESS",
                "DATA MIGRATION",
                "REPORTS",
                "GO LIVE INITIATION",
                "TAKE OVER FORM"
            ];

            columnOrder.forEach(columnTitle => {
                const issuesInColumn = kanbanData[columnTitle] || [];

                const columnDiv = document.createElement('div');
                columnDiv.classList.add('kanban-column');

                const columnHeader = document.createElement('div');
                columnHeader.classList.add('column-header');
                columnHeader.innerHTML = `<h3>${columnTitle}</h3><span>${issuesInColumn.length}</span>`;
                columnDiv.appendChild(columnHeader);

                const cardList = document.createElement('div');
                cardList.classList.add('card-list');

                issuesInColumn.forEach(issue => {
                    const card = document.createElement('div');
                    card.classList.add('kanban-card');

                    // Determine card background based on display_status
                    let statusClass = '';
                    let statusBadgeText = '';
                    if (issue.status === 'Done') {
                        statusClass = 'card-done';
                        statusBadgeText = 'Completed';
                    } else if (issue.status === 'In Progress') {
                        statusClass = 'card-in-progress';
                        statusBadgeText = 'In Progress';
                    } else if (issue.status === 'Not Started') {
                        statusClass = 'card-not-started';
                        statusBadgeText = 'Not Started';
                    } else {
                        statusClass = 'card-other'; // For unmapped Jira statuses
                        statusBadgeText = issue.jiraStatus; // Use raw Jira status for unmapped
                    }
                    card.classList.add(statusClass);


                    card.innerHTML = `
                        <h4 class="card-title">${issue.title}</h4>
                        <div class="card-meta">
                            <span class="card-key">${issue.key}</span>
                            <span class="card-date">Started: ${new Date(issue.startDate).toLocaleDateString()}</span>
                        </div>
                        <div class="card-status-badge badge-${issue.status.toLowerCase().replace(/ /g, '-s')}">${statusBadgeText}</div>
                    `;
                    cardList.appendChild(card);
                });
                columnDiv.appendChild(cardList);
                kanbanContainer.appendChild(columnDiv);
            });
            console.log('✅ Kanban Board updated successfully', kanbanData);
        }

        async function validateCurrentProject() {
            if (!currentProject) {
                showError('No project selected');
                return false;
            }
            
            try {
                const validationResponse = await fetch(`/api/jira/validate-project?projectKey=${currentProject}`);
                const validation = await validationResponse.json();
                
                if (validation.valid) {
                    console.log(`✅ Project ${currentProject} is valid:`, validation.project);
                    return true;
                } else {
                    console.error(`❌ Project ${currentProject} is not valid:`, validation.error);
                    showError(`Project ${currentProject} not found or inaccessible`);
                    return false;
                }
            } catch (error) {
                console.error(`❌ Project validation error:`, error);
                showError(`Failed to validate project: ${error.message}`);
                return false;
            }
        }

        async function updateDashboard(projectKey) {
            if (isLoading) return;
            
            currentProject = projectKey;
            const projectName = availableProjects.find(p => p.key === currentProject)?.name || currentProject;
            document.getElementById('project-display-name').textContent = projectName;
            showLoading();

            try {
                // Fetch all data concurrently
                const [statsData, healthData, actionItemsData, risksData, kanbanData, newTimelineData, overviewData, metricsData, deliverablesData, teamMembersData] = await Promise.all([
                    fetchData(`/api/jira/project-stats?projectKey=${projectKey}`),
                    fetchData(`/api/jira/project-health?projectKey=${projectKey}`),
                    fetchData(`/api/jira/action-items?projectKey=${projectKey}`),
                    fetchData(`/api/jira/risks?projectKey=${projectKey}`),
                    fetchKanbanData(), // This already uses currentProject
                    fetchData(`/api/jira/new-timeline-data?projectKey=${projectKey}`),
                    fetchProjectOverview(), // Fetch project overview data
                    fetchKeyMetrics(), // Fetch key metrics data
                    fetchDeliverables(), // Fetch deliverables data
                    fetchTeamMembers() // Fetch team members data
                ]);

                // Update UI components
                updateStats(statsData);
                updateHealthMetrics(healthData);
                updateActionItems(actionItemsData);
                updateRisks(risksData);
                updateKanbanBoard(kanbanData); // Update the Kanban board
                updateNewTimeline(newTimelineData); // Update the new timeline
                updateProjectOverview(overviewData); // Update project overview
                updateKeyMetrics(metricsData); // Update key metrics
                updateDeliverables(deliverablesData); // Update deliverables
                updateTeamMembers(teamMembersData); // Update team members

                console.log('Dashboard updated successfully for project:', projectKey);
            } catch (error) {
                console.error('Error updating dashboard:', error);
                showError(`Failed to load dashboard data: ${error.message}`);
            } finally {
                hideLoading();
            }
        }

        // Test all endpoints for debugging
        async function testAllEndpoints() {
            const projectKey = currentProject;
            if (!projectKey) {
                console.warn('No project selected for testing endpoints.');
                return;
            }
            console.log(`\n--- Testing all API endpoints for project: ${projectKey} ---\n`);

            const endpoints = {
                'Project Stats': `/api/jira/project-stats?projectKey=${projectKey}`,
                'Project Health': `/api/jira/project-health?projectKey=${projectKey}`,
                'Action Items': `/api/jira/action-items?projectKey=${projectKey}`,
                'Risks': `/api/jira/risks?projectKey=${projectKey}`,
                'Kanban Board Data': `/api/jira/kanban-board-data?projectKey=${projectKey}`,
                'New Timeline Data': `/api/jira/new-timeline-data?projectKey=${projectKey}`,
                'Teams Auth Status': '/api/teams/auth-status'
            };

            for (const [name, url] of Object.entries(endpoints)) {
                try {
                    const data = await fetchData(url);
                    console.log(`✅ ${name} (${url}):`, data);
                } catch (error) {
                    console.error(`❌ ${name} (${url}) error:`, error);
                }
            }
            console.log('\n--- All endpoint tests completed ---\n');
        }

        // Event Listeners and Initial Load
        document.addEventListener('DOMContentLoaded', async () => {
            // Initial project load, then test all endpoints
            await validateCurrentProject();
            await fetchAvailableProjects();
            await fetchTeamsAuthStatus(); // Fetch Teams auth status on load
            if (currentProject) {
                await updateDashboard(currentProject);
            }
            // Automatically run endpoint tests for debugging after initial load
            testAllEndpoints(); 
        });

        // Add change listener to project select
        document.getElementById('project-select').addEventListener('change', (event) => {
            const newProjectKey = event.target.value;
            updateDashboard(newProjectKey);
        });

        // Initial call to set current project if available from session
        if (sessionProjectKey) {
            currentProject = sessionProjectKey;
        }

        // Add event listeners for tab buttons
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                console.log('Tab clicked:', tabId);
                showTab(tabId);
                
                // Fetch specific data based on the active tab
                if (currentProject) {
                    if (tabId === 'team-members') {
                        console.log('Fetching team members data...');
                        fetchTeamMembers().then(data => {
                            console.log('Team members data fetched:', data);
                            updateTeamMembers(data);
                        }).catch(error => {
                            console.error('Error fetching team members:', error);
                            showError('Failed to load team members data');
                        });
                    } else {
                        updateDashboard(currentProject);
                    }
                }
            });
        });

        function showTab(tabId) {
            console.log('Showing tab:', tabId);
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.classList.add('active');
                console.log('Tab content activated:', tabId);
            } else {
                console.error('Tab content not found:', tabId);
            }
            
            // Add active class to clicked button
            const clickedButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);
            if (clickedButton) {
                clickedButton.classList.add('active');
                console.log('Tab button activated:', tabId);
            } else {
                console.error('Tab button not found:', tabId);
            }
        }

        // New function to update Project Overview
        async function updateProjectOverview() {
            try {
                const overviewData = await fetchProjectOverview();
                updateProjectOverview(overviewData);
            } catch (error) {
                console.error('Error updating project overview:', error);
                showError('Failed to load project overview.');
            }
        }

        // New function to update Key Metrics
        async function updateKeyMetrics() {
            try {
                const metricsData = await fetchKeyMetrics();
                updateKeyMetrics(metricsData);
            } catch (error) {
                console.error('Error updating key metrics:', error);
                showError('Failed to load key metrics.');
            }
        }

        // New function to update Deliverables
        async function updateDeliverables() {
            try {
                const deliverablesData = await fetchDeliverables();
                updateDeliverables(deliverablesData);
                } catch (error) {
                console.error('Error updating deliverables:', error);
                showError('Failed to load deliverables.');
            }
        }

        // Update Project Overview
        function updateProjectOverview(overviewData) {
            const projectDescriptionElement = document.getElementById('project-description');
            if (projectDescriptionElement && overviewData) {
                projectDescriptionElement.textContent = overviewData.description || "No project description available.";
            }
        }

        // Update Key Metrics
        function updateKeyMetrics(metricsData) {
            if (!metricsData) return;
            document.getElementById('metric-total-tasks').textContent = metricsData.totalTasks || 0;
            document.getElementById('metric-completed-tasks').textContent = metricsData.completedTasks || 0;
            document.getElementById('metric-open-issues').textContent = metricsData.openIssues || 0;
            document.getElementById('metric-progress').textContent = `${metricsData.overallProgress || 0}%`;
        }

        // Update Deliverables
        function updateDeliverables(deliverablesData) {
            const deliverablesList = document.getElementById('deliverables-list');
            if (!deliverablesList || !deliverablesData || !deliverablesData.length) {
                deliverablesList.innerHTML = '<li>No deliverables found.</li>';
                return;
            }

            deliverablesList.innerHTML = ''; // Clear existing items
            deliverablesData.forEach(deliverable => {
                const listItem = document.createElement('li');
                listItem.classList.add(deliverable.status.toLowerCase().replace(/ /g, '-')); // e.g., 'completed', 'in-progress'
                listItem.innerHTML = `
                    <span class="deliverable-item">${deliverable.name}</span>
                    <div>
                        <span class="deliverable-status ${deliverable.status.toLowerCase().replace(/ /g, '-')}">${deliverable.status}</span>
                        <span class="deliverable-date">Due: ${deliverable.dueDate}</span>
                        </div>
                `;
                deliverablesList.appendChild(listItem);
            });
        }
    </script>
</body>
</html>